# 分片上传系统

完整的前端后端分片上传系统，支持大文件上传、断点续传、进度显示、并发控制等功能。

## 功能特性

### 🚀 核心功能
- **分片上传**: 将大文件切割成小块并行上传
- **断点续传**: 支持暂停和恢复上传
- **进度显示**: 实时显示上传进度、速度和剩余时间
- **并发控制**: 可配置并发上传数量
- **文件校验**: MD5校验确保文件完整性
- **错误重试**: 自动重试失败的分片
- **秒传功能**: 相同文件无需重复上传

### 🎨 界面功能
- **拖拽上传**: 支持拖拽文件到上传区域
- **实时反馈**: 详细的上传状态和进度信息
- **响应式设计**: 适配不同屏幕尺寸
- **友好交互**: 直观的操作按钮和状态提示

## 技术栈

### 后端
- **Node.js**: 运行环境
- **Express**: Web框架
- **Multer**: 文件上传中间件
- **fs-extra**: 增强文件系统操作
- **crypto**: 文件哈希计算

### 前端
- **React 18**: 前端框架
- **Ant Design**: UI组件库
- **Axios**: HTTP客户端
- **SparkMD5**: 文件MD5计算
- **自定义Hooks**: 状态管理和逻辑复用

## 项目结构

```
分片上传/
├── package.json              # 项目配置
├── server/                   # 后端服务
│   └── app.js               # Express服务器
├── client/                  # React前端
│   ├── package.json         # 前端依赖
│   ├── public/             
│   │   └── index.html       # HTML模板
│   └── src/
│       ├── index.js         # 入口文件
│       ├── index.css        # 全局样式
│       ├── App.js           # 根组件
│       ├── components/
│       │   └── ChunkUpload.js  # 分片上传组件
│       ├── hooks/
│       │   └── useChunkUpload.js  # 上传逻辑Hook
│       ├── services/
│       │   └── api.js       # API接口
│       └── utils/
│           └── fileUtils.js # 文件处理工具
├── uploads/                 # 上传文件目录（自动创建）
└── chunks/                  # 临时分片目录（自动创建）
```

## 安装和运行

### 1. 安装依赖

```bash
# 安装后端依赖
npm install

# 安装前端依赖
cd client
npm install
```

### 2. 启动服务

```bash
# 启动后端服务器（端口3001）
npm start
# 或者开发模式
npm run dev

# 启动前端应用（端口3000）
cd client
npm start
```

### 3. 访问应用

打开浏览器访问：http://localhost:3000

## API接口

### 文件检查
- **POST** `/api/check-file`
- 检查文件是否已存在，获取已上传的分片信息

### 分片上传
- **POST** `/api/upload-chunk` 
- 上传单个文件分片

### 文件合并
- **POST** `/api/merge-chunks`
- 合并所有分片为完整文件

### 文件列表
- **GET** `/api/uploads`
- 获取已上传的文件列表

## 配置说明

### 分片大小
默认分片大小为2MB，可在 `client/src/utils/fileUtils.js` 中修改：
```javascript
export const CHUNK_SIZE = 2 * 1024 * 1024; // 2MB
```

### 并发数量
默认并发上传3个分片，可在上传时自定义：
```javascript
startUpload(5); // 5个并发
```

### 端口配置
- 后端服务器：3001端口
- 前端应用：3000端口

可在对应配置文件中修改端口设置。

## 使用说明

### 1. 选择文件
- 点击上传区域选择文件
- 或直接拖拽文件到上传区域

### 2. 查看信息
系统会自动计算文件哈希值并显示：
- 文件基本信息
- 分片数量
- 是否可以断点续传

### 3. 开始上传
- 点击"开始上传"按钮开始上传
- 实时查看上传进度、速度、剩余时间

### 4. 控制上传
- **暂停**: 随时暂停上传
- **继续**: 从断点处继续上传
- **重新选择**: 选择新文件

## 特性详解

### 断点续传原理
1. 文件选择后计算MD5哈希值
2. 向服务器查询已上传的分片
3. 只上传未完成的分片
4. 支持暂停后继续上传

### 文件校验机制
1. 前端计算文件MD5哈希值
2. 服务器合并后重新计算哈希值
3. 对比确保文件完整性
4. 校验失败自动删除文件

### 并发控制策略
1. 限制同时上传的分片数量
2. 失败分片自动重试
3. 动态调整上传速度

## 错误处理

### 常见错误
- **网络中断**: 自动暂停，恢复后可继续
- **分片丢失**: 自动重新上传缺失分片
- **校验失败**: 提示重新上传
- **服务器错误**: 显示具体错误信息

### 调试建议
1. 检查网络连接
2. 确认服务器正常运行
3. 查看浏览器控制台错误
4. 检查文件权限

## 性能优化

### 前端优化
- 使用Web Worker计算文件哈希（可选）
- 分片大小可配置
- 并发数量可调节
- 内存使用优化

### 后端优化
- 流式处理大文件
- 临时文件自动清理
- 错误恢复机制
- 并发请求限制

## 扩展功能

### 可扩展的功能
1. **文件类型限制**: 限制上传文件类型
2. **文件大小限制**: 设置最大文件大小
3. **用户认证**: 添加登录验证
4. **云存储**: 集成OSS/S3等云服务
5. **压缩上传**: 分片压缩减少带宽
6. **多文件上传**: 支持批量文件上传

## 注意事项

1. **存储空间**: 确保服务器有足够存储空间
2. **网络稳定**: 网络不稳定时建议减少并发数
3. **浏览器兼容**: 现代浏览器支持，IE需要polyfill
4. **文件权限**: 确保上传目录有写权限

## 许可证

MIT License